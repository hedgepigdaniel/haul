"use strict";

var cov_10p46dsing = function () {
  var path = "/home/daniel/code/oss/js/haul/packages/haul-core/src/runtime/Logger.ts";
  var hash = "d7361953c0d69700238fca6f3431f3b5b19aa94d";
  var global = new Function("return this")();
  var gcv = "__coverage__";
  var coverageData = {
    path: "/home/daniel/code/oss/js/haul/packages/haul-core/src/runtime/Logger.ts",
    statementMap: {
      "0": {
        start: {
          line: 24,
          column: 32
        },
        end: {
          line: 30,
          column: 1
        }
      },
      "1": {
        start: {
          line: 32,
          column: 29
        },
        end: {
          line: 38,
          column: 1
        }
      },
      "2": {
        start: {
          line: 42,
          column: 17
        },
        end: {
          line: 42,
          column: 28
        }
      },
      "3": {
        start: {
          line: 43,
          column: 29
        },
        end: {
          line: 43,
          column: 49
        }
      },
      "4": {
        start: {
          line: 47,
          column: 22
        },
        end: {
          line: 47,
          column: 27
        }
      },
      "5": {
        start: {
          line: 48,
          column: 40
        },
        end: {
          line: 48,
          column: 56
        }
      },
      "6": {
        start: {
          line: 58,
          column: 24
        },
        end: {
          line: 60,
          column: 30
        }
      },
      "7": {
        start: {
          line: 61,
          column: 4
        },
        end: {
          line: 61,
          column: 49
        }
      },
      "8": {
        start: {
          line: 62,
          column: 4
        },
        end: {
          line: 62,
          column: 26
        }
      },
      "9": {
        start: {
          line: 71,
          column: 4
        },
        end: {
          line: 73,
          column: 5
        }
      },
      "10": {
        start: {
          line: 72,
          column: 6
        },
        end: {
          line: 72,
          column: 33
        }
      },
      "11": {
        start: {
          line: 76,
          column: 9
        },
        end: {
          line: 76,
          column: 53
        }
      },
      "12": {
        start: {
          line: 77,
          column: 9
        },
        end: {
          line: 77,
          column: 53
        }
      },
      "13": {
        start: {
          line: 78,
          column: 10
        },
        end: {
          line: 78,
          column: 55
        }
      },
      "14": {
        start: {
          line: 79,
          column: 9
        },
        end: {
          line: 79,
          column: 53
        }
      },
      "15": {
        start: {
          line: 80,
          column: 10
        },
        end: {
          line: 80,
          column: 55
        }
      },
      "16": {
        start: {
          line: 87,
          column: 10
        },
        end: {
          line: 92,
          column: 3
        }
      },
      "17": {
        start: {
          line: 88,
          column: 4
        },
        end: {
          line: 88,
          column: 32
        }
      },
      "18": {
        start: {
          line: 89,
          column: 4
        },
        end: {
          line: 91,
          column: 6
        }
      },
      "19": {
        start: {
          line: 90,
          column: 6
        },
        end: {
          line: 90,
          column: 36
        }
      },
      "20": {
        start: {
          line: 97,
          column: 10
        },
        end: {
          line: 100,
          column: 3
        }
      },
      "21": {
        start: {
          line: 99,
          column: 4
        },
        end: {
          line: 99,
          column: 25
        }
      },
      "22": {
        start: {
          line: 105,
          column: 21
        },
        end: {
          line: 107,
          column: 3
        }
      },
      "23": {
        start: {
          line: 106,
          column: 4
        },
        end: {
          line: 106,
          column: 67
        }
      },
      "24": {
        start: {
          line: 112,
          column: 24
        },
        end: {
          line: 114,
          column: 3
        }
      },
      "25": {
        start: {
          line: 113,
          column: 4
        },
        end: {
          line: 113,
          column: 70
        }
      },
      "26": {
        start: {
          line: 120,
          column: 21
        },
        end: {
          line: 128,
          column: 3
        }
      },
      "27": {
        start: {
          line: 121,
          column: 4
        },
        end: {
          line: 127,
          column: 14
        }
      },
      "28": {
        start: {
          line: 135,
          column: 4
        },
        end: {
          line: 143,
          column: 6
        }
      },
      "29": {
        start: {
          line: 136,
          column: 6
        },
        end: {
          line: 142,
          column: 12
        }
      },
      "30": {
        start: {
          line: 147,
          column: 4
        },
        end: {
          line: 180,
          column: 6
        }
      },
      "31": {
        start: {
          line: 148,
          column: 6
        },
        end: {
          line: 150,
          column: 7
        }
      },
      "32": {
        start: {
          line: 149,
          column: 8
        },
        end: {
          line: 149,
          column: 69
        }
      },
      "33": {
        start: {
          line: 152,
          column: 6
        },
        end: {
          line: 168,
          column: 7
        }
      },
      "34": {
        start: {
          line: 153,
          column: 24
        },
        end: {
          line: 153,
          column: 59
        }
      },
      "35": {
        start: {
          line: 154,
          column: 8
        },
        end: {
          line: 167,
          column: 10
        }
      },
      "36": {
        start: {
          line: 170,
          column: 6
        },
        end: {
          line: 179,
          column: 7
        }
      },
      "37": {
        start: {
          line: 174,
          column: 8
        },
        end: {
          line: 178,
          column: 9
        }
      },
      "38": {
        start: {
          line: 175,
          column: 10
        },
        end: {
          line: 175,
          column: 44
        }
      },
      "39": {
        start: {
          line: 177,
          column: 10
        },
        end: {
          line: 177,
          column: 60
        }
      }
    },
    fnMap: {
      "0": {
        name: "(anonymous_0)",
        decl: {
          start: {
            line: 50,
            column: 2
          },
          end: {
            line: 50,
            column: 3
          }
        },
        loc: {
          start: {
            line: 50,
            column: 57
          },
          end: {
            line: 50,
            column: 59
          }
        },
        line: 50
      },
      "1": {
        name: "(anonymous_1)",
        decl: {
          start: {
            line: 57,
            column: 2
          },
          end: {
            line: 57,
            column: 3
          }
        },
        loc: {
          start: {
            line: 57,
            column: 67
          },
          end: {
            line: 63,
            column: 3
          }
        },
        line: 57
      },
      "2": {
        name: "(anonymous_2)",
        decl: {
          start: {
            line: 70,
            column: 2
          },
          end: {
            line: 70,
            column: 3
          }
        },
        loc: {
          start: {
            line: 70,
            column: 12
          },
          end: {
            line: 74,
            column: 3
          }
        },
        line: 70
      },
      "3": {
        name: "(anonymous_3)",
        decl: {
          start: {
            line: 87,
            column: 10
          },
          end: {
            line: 87,
            column: 11
          }
        },
        loc: {
          start: {
            line: 87,
            column: 51
          },
          end: {
            line: 92,
            column: 3
          }
        },
        line: 87
      },
      "4": {
        name: "(anonymous_4)",
        decl: {
          start: {
            line: 89,
            column: 11
          },
          end: {
            line: 89,
            column: 12
          }
        },
        loc: {
          start: {
            line: 89,
            column: 17
          },
          end: {
            line: 91,
            column: 5
          }
        },
        line: 89
      },
      "5": {
        name: "(anonymous_5)",
        decl: {
          start: {
            line: 97,
            column: 10
          },
          end: {
            line: 97,
            column: 11
          }
        },
        loc: {
          start: {
            line: 97,
            column: 34
          },
          end: {
            line: 100,
            column: 3
          }
        },
        line: 97
      },
      "6": {
        name: "(anonymous_6)",
        decl: {
          start: {
            line: 105,
            column: 21
          },
          end: {
            line: 105,
            column: 22
          }
        },
        loc: {
          start: {
            line: 105,
            column: 66
          },
          end: {
            line: 107,
            column: 3
          }
        },
        line: 105
      },
      "7": {
        name: "(anonymous_7)",
        decl: {
          start: {
            line: 112,
            column: 24
          },
          end: {
            line: 112,
            column: 25
          }
        },
        loc: {
          start: {
            line: 112,
            column: 72
          },
          end: {
            line: 114,
            column: 3
          }
        },
        line: 112
      },
      "8": {
        name: "(anonymous_8)",
        decl: {
          start: {
            line: 120,
            column: 21
          },
          end: {
            line: 120,
            column: 22
          }
        },
        loc: {
          start: {
            line: 120,
            column: 65
          },
          end: {
            line: 128,
            column: 3
          }
        },
        line: 120
      },
      "9": {
        name: "(anonymous_9)",
        decl: {
          start: {
            line: 134,
            column: 2
          },
          end: {
            line: 134,
            column: 3
          }
        },
        loc: {
          start: {
            line: 134,
            column: 25
          },
          end: {
            line: 144,
            column: 3
          }
        },
        line: 134
      },
      "10": {
        name: "(anonymous_10)",
        decl: {
          start: {
            line: 135,
            column: 20
          },
          end: {
            line: 135,
            column: 21
          }
        },
        loc: {
          start: {
            line: 136,
            column: 6
          },
          end: {
            line: 142,
            column: 12
          }
        },
        line: 136
      },
      "11": {
        name: "(anonymous_11)",
        decl: {
          start: {
            line: 146,
            column: 2
          },
          end: {
            line: 146,
            column: 3
          }
        },
        loc: {
          start: {
            line: 146,
            column: 52
          },
          end: {
            line: 181,
            column: 3
          }
        },
        line: 146
      },
      "12": {
        name: "(anonymous_12)",
        decl: {
          start: {
            line: 147,
            column: 11
          },
          end: {
            line: 147,
            column: 12
          }
        },
        loc: {
          start: {
            line: 147,
            column: 35
          },
          end: {
            line: 180,
            column: 5
          }
        },
        line: 147
      }
    },
    branchMap: {
      "0": {
        loc: {
          start: {
            line: 58,
            column: 24
          },
          end: {
            line: 60,
            column: 30
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 59,
            column: 8
          },
          end: {
            line: 59,
            column: 16
          }
        }, {
          start: {
            line: 60,
            column: 8
          },
          end: {
            line: 60,
            column: 30
          }
        }],
        line: 58
      },
      "1": {
        loc: {
          start: {
            line: 71,
            column: 4
          },
          end: {
            line: 73,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 71,
            column: 4
          },
          end: {
            line: 73,
            column: 5
          }
        }, {
          start: {
            line: 71,
            column: 4
          },
          end: {
            line: 73,
            column: 5
          }
        }],
        line: 71
      },
      "2": {
        loc: {
          start: {
            line: 136,
            column: 6
          },
          end: {
            line: 142,
            column: 12
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 137,
            column: 10
          },
          end: {
            line: 137,
            column: 14
          }
        }, {
          start: {
            line: 138,
            column: 10
          },
          end: {
            line: 142,
            column: 12
          }
        }],
        line: 136
      },
      "3": {
        loc: {
          start: {
            line: 148,
            column: 6
          },
          end: {
            line: 150,
            column: 7
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 148,
            column: 6
          },
          end: {
            line: 150,
            column: 7
          }
        }, {
          start: {
            line: 148,
            column: 6
          },
          end: {
            line: 150,
            column: 7
          }
        }],
        line: 148
      },
      "4": {
        loc: {
          start: {
            line: 152,
            column: 6
          },
          end: {
            line: 168,
            column: 7
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 152,
            column: 6
          },
          end: {
            line: 168,
            column: 7
          }
        }, {
          start: {
            line: 152,
            column: 6
          },
          end: {
            line: 168,
            column: 7
          }
        }],
        line: 152
      },
      "5": {
        loc: {
          start: {
            line: 156,
            column: 11
          },
          end: {
            line: 164,
            column: 76
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 157,
            column: 14
          },
          end: {
            line: 163,
            column: 15
          }
        }, {
          start: {
            line: 164,
            column: 14
          },
          end: {
            line: 164,
            column: 76
          }
        }],
        line: 156
      },
      "6": {
        loc: {
          start: {
            line: 170,
            column: 6
          },
          end: {
            line: 179,
            column: 7
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 170,
            column: 6
          },
          end: {
            line: 179,
            column: 7
          }
        }, {
          start: {
            line: 170,
            column: 6
          },
          end: {
            line: 179,
            column: 7
          }
        }],
        line: 170
      },
      "7": {
        loc: {
          start: {
            line: 174,
            column: 8
          },
          end: {
            line: 178,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 174,
            column: 8
          },
          end: {
            line: 178,
            column: 9
          }
        }, {
          start: {
            line: 174,
            column: 8
          },
          end: {
            line: 178,
            column: 9
          }
        }],
        line: 174
      }
    },
    s: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0,
      "13": 0,
      "14": 0,
      "15": 0,
      "16": 0,
      "17": 0,
      "18": 0,
      "19": 0,
      "20": 0,
      "21": 0,
      "22": 0,
      "23": 0,
      "24": 0,
      "25": 0,
      "26": 0,
      "27": 0,
      "28": 0,
      "29": 0,
      "30": 0,
      "31": 0,
      "32": 0,
      "33": 0,
      "34": 0,
      "35": 0,
      "36": 0,
      "37": 0,
      "38": 0,
      "39": 0
    },
    f: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0
    },
    b: {
      "0": [0, 0],
      "1": [0, 0],
      "2": [0, 0],
      "3": [0, 0],
      "4": [0, 0],
      "5": [0, 0],
      "6": [0, 0],
      "7": [0, 0]
    },
    _coverageSchema: "43e27e138ebf9cfc5966b082cf9a028302ed4184",
    hash: "d7361953c0d69700238fca6f3431f3b5b19aa94d"
  };
  var coverage = global[gcv] || (global[gcv] = {});

  if (coverage[path] && coverage[path].hash === hash) {
    return coverage[path];
  }

  return coverage[path] = coverageData;
}();

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _util = require("util");

var _fs = _interopRequireDefault(require("fs"));

var _path = _interopRequireDefault(require("path"));

var _stripAnsi = _interopRequireDefault(require("strip-ansi"));

var _inspectorEvents = require("@haul-bundler/inspector-events");

var _ansiFragments = require("ansi-fragments");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

var LoggerLevel;

(function (LoggerLevel) {
  LoggerLevel["Debug"] = "debug";
  LoggerLevel["Info"] = "info";
  LoggerLevel["Warn"] = "warn";
  LoggerLevel["Error"] = "error";
  LoggerLevel["Done"] = "done";
})(LoggerLevel || (LoggerLevel = {}));

const levelToPriorityMappings = (cov_10p46dsing.s[0]++, {
  [LoggerLevel.Debug]: 0,
  [LoggerLevel.Info]: 1,
  [LoggerLevel.Done]: 2,
  [LoggerLevel.Warn]: 3,
  [LoggerLevel.Error]: 4
});
const levelToColorMappings = (cov_10p46dsing.s[1]++, {
  [LoggerLevel.Info]: 'blue',
  [LoggerLevel.Warn]: 'yellow',
  [LoggerLevel.Error]: 'red',
  [LoggerLevel.Done]: 'green',
  [LoggerLevel.Debug]: 'gray'
});

class Logger {
  constructor(inspectorClient) {
    this.inspectorClient = inspectorClient;

    _defineProperty(this, "proxyHandler", void 0);

    _defineProperty(this, "logFile", void 0);

    _defineProperty(this, "logAsJson", (cov_10p46dsing.s[4]++, false));

    _defineProperty(this, "minLoggingLevel", (cov_10p46dsing.s[5]++, LoggerLevel.Info));

    _defineProperty(this, "info", (cov_10p46dsing.s[11]++, this.createLoggingFunction(LoggerLevel.Info)));

    _defineProperty(this, "warn", (cov_10p46dsing.s[12]++, this.createLoggingFunction(LoggerLevel.Warn)));

    _defineProperty(this, "error", (cov_10p46dsing.s[13]++, this.createLoggingFunction(LoggerLevel.Error)));

    _defineProperty(this, "done", (cov_10p46dsing.s[14]++, this.createLoggingFunction(LoggerLevel.Done)));

    _defineProperty(this, "debug", (cov_10p46dsing.s[15]++, this.createLoggingFunction(LoggerLevel.Debug)));

    _defineProperty(this, "proxy", (cov_10p46dsing.s[16]++, handler => {
      cov_10p46dsing.f[3]++;
      cov_10p46dsing.s[17]++;
      this.proxyHandler = handler;
      cov_10p46dsing.s[18]++;
      return () => {
        cov_10p46dsing.f[4]++;
        cov_10p46dsing.s[19]++;
        this.proxyHandler = undefined;
      };
    }));

    _defineProperty(this, "print", (cov_10p46dsing.s[20]++, (...args) => {
      cov_10p46dsing.f[5]++;
      cov_10p46dsing.s[21]++;
      // eslint-disable-next-line no-console
      console.log(...args);
    }));

    _defineProperty(this, "enhanceWithColor", (cov_10p46dsing.s[22]++, (enhancer, ...args) => {
      cov_10p46dsing.f[6]++;
      cov_10p46dsing.s[23]++;
      return (0, _ansiFragments.color)(enhancer, this.stringify(args).join(' ')).build();
    }));

    _defineProperty(this, "enhanceWithModifier", (cov_10p46dsing.s[24]++, (enhancer, ...args) => {
      cov_10p46dsing.f[7]++;
      cov_10p46dsing.s[25]++;
      return (0, _ansiFragments.modifier)(enhancer, this.stringify(args).join(' ')).build();
    }));

    _defineProperty(this, "enhanceWithLevel", (cov_10p46dsing.s[26]++, (level, ...args) => {
      cov_10p46dsing.f[8]++;
      cov_10p46dsing.s[27]++;
      return (0, _ansiFragments.container)((0, _ansiFragments.color)(levelToColorMappings[level], (0, _ansiFragments.modifier)('bold', level)), (0, _ansiFragments.pad)(1), '▶︎', (0, _ansiFragments.pad)(1), this.stringify(args).join(' ')).build();
    }));

    cov_10p46dsing.f[0]++;
  }
  /**
   * Enables logging all messages to file as well as to process' STDOUT.
   * If `json` is `true` each log will be in JSON format for easier processing.
   * If relative `filename` is passed, it will be resolved based on process' CWD.
   */


  enableFileLogging(filename, {
    json
  }) {
    cov_10p46dsing.f[1]++;
    const absFilename = (cov_10p46dsing.s[6]++, _path.default.isAbsolute(filename) ? (cov_10p46dsing.b[0][0]++, filename) : (cov_10p46dsing.b[0][1]++, _path.default.resolve(filename)));
    cov_10p46dsing.s[7]++;
    this.logFile = _fs.default.openSync(absFilename, 'a');
    cov_10p46dsing.s[8]++;
    this.logAsJson = json;
  }
  /**
   * Disposes the logger by closing all open handles.
   * If file logging was enabled, the file descriptor will be closed here.
   * Should always be called before exiting from process.
   */


  dispose() {
    cov_10p46dsing.f[2]++;
    cov_10p46dsing.s[9]++;

    if (this.logFile !== undefined) {
      cov_10p46dsing.b[1][0]++;
      cov_10p46dsing.s[10]++;

      _fs.default.closeSync(this.logFile);
    } else {
      cov_10p46dsing.b[1][1]++;
    }
  }

  /**
   * Stringify array of elements into a string array.
   * Uses Node's built-in `util.inspect` function to stringify non-string elements.
   */
  stringify(args) {
    cov_10p46dsing.f[9]++;
    cov_10p46dsing.s[28]++;
    return args.map(item => {
      cov_10p46dsing.f[10]++;
      cov_10p46dsing.s[29]++;
      return typeof item === 'string' ? (cov_10p46dsing.b[2][0]++, item) : (cov_10p46dsing.b[2][1]++, (0, _util.inspect)(item, {
        depth: null,
        maxArrayLength: null,
        breakLength: Infinity
      }));
    });
  }

  createLoggingFunction(level) {
    cov_10p46dsing.f[11]++;
    cov_10p46dsing.s[30]++;
    return (...args) => {
      cov_10p46dsing.f[12]++;
      cov_10p46dsing.s[31]++;

      if (this.inspectorClient) {
        cov_10p46dsing.b[3][0]++;
        cov_10p46dsing.s[32]++;
        this.inspectorClient.emitEvent(new _inspectorEvents.LoggerEvent(level, args));
      } else {
        cov_10p46dsing.b[3][1]++;
      }

      cov_10p46dsing.s[33]++;

      if (this.logFile !== undefined) {
        cov_10p46dsing.b[4][0]++;
        const rawArgs = (cov_10p46dsing.s[34]++, this.stringify(args).map(_stripAnsi.default));
        cov_10p46dsing.s[35]++;

        _fs.default.appendFileSync(this.logFile, (this.logAsJson ? (cov_10p46dsing.b[5][0]++, (0, _stripAnsi.default)(JSON.stringify({
          timestamp: new Date(),
          level,
          messages: rawArgs
        }))) : (cov_10p46dsing.b[5][1]++, `[${new Date().toISOString()}] ${level}: ${rawArgs.join(' ')}`)) + '\n', 'utf8');
      } else {
        cov_10p46dsing.b[4][1]++;
      }

      cov_10p46dsing.s[36]++;

      if (levelToPriorityMappings[level] >= levelToPriorityMappings[this.minLoggingLevel]) {
        cov_10p46dsing.b[6][0]++;
        cov_10p46dsing.s[37]++;

        if (this.proxyHandler) {
          cov_10p46dsing.b[7][0]++;
          cov_10p46dsing.s[38]++;
          this.proxyHandler(level, ...args);
        } else {
          cov_10p46dsing.b[7][1]++;
          cov_10p46dsing.s[39]++;
          this.print(this.enhanceWithLevel(level, ...args));
        }
      } else {
        cov_10p46dsing.b[6][1]++;
      }
    };
  }

}

exports.default = Logger;

_defineProperty(Logger, "Level", (cov_10p46dsing.s[2]++, LoggerLevel));

_defineProperty(Logger, "LevelColorMapping", (cov_10p46dsing.s[3]++, levelToColorMappings));
//# sourceMappingURL=Logger.js.map