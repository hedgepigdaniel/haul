"use strict";

var cov_1quqfxxwz1 = function () {
  var path = "/home/daniel/code/oss/js/haul/packages/haul-core/src/server/openInEditor.ts";
  var hash = "92e7dced54177813dd240aefab92b05474905ca0";
  var global = new Function("return this")();
  var gcv = "__coverage__";
  var coverageData = {
    path: "/home/daniel/code/oss/js/haul/packages/haul-core/src/server/openInEditor.ts",
    statementMap: {
      "0": {
        start: {
          line: 5,
          column: 16
        },
        end: {
          line: 5,
          column: 66
        }
      },
      "1": {
        start: {
          line: 31,
          column: 22
        },
        end: {
          line: 32,
          column: 41
        }
      },
      "2": {
        start: {
          line: 32,
          column: 2
        },
        end: {
          line: 32,
          column: 41
        }
      },
      "3": {
        start: {
          line: 44,
          column: 2
        },
        end: {
          line: 49,
          column: 3
        }
      },
      "4": {
        start: {
          line: 45,
          column: 19
        },
        end: {
          line: 45,
          column: 58
        }
      },
      "5": {
        start: {
          line: 46,
          column: 4
        },
        end: {
          line: 48,
          column: 5
        }
      },
      "6": {
        start: {
          line: 47,
          column: 6
        },
        end: {
          line: 47,
          column: 20
        }
      },
      "7": {
        start: {
          line: 51,
          column: 2
        },
        end: {
          line: 51,
          column: 19
        }
      },
      "8": {
        start: {
          line: 61,
          column: 2
        },
        end: {
          line: 63,
          column: 3
        }
      },
      "9": {
        start: {
          line: 62,
          column: 4
        },
        end: {
          line: 62,
          column: 40
        }
      },
      "10": {
        start: {
          line: 66,
          column: 2
        },
        end: {
          line: 68,
          column: 3
        }
      },
      "11": {
        start: {
          line: 67,
          column: 4
        },
        end: {
          line: 67,
          column: 36
        }
      },
      "12": {
        start: {
          line: 70,
          column: 2
        },
        end: {
          line: 70,
          column: 19
        }
      },
      "13": {
        start: {
          line: 78,
          column: 2
        },
        end: {
          line: 78,
          column: 55
        }
      },
      "14": {
        start: {
          line: 82,
          column: 41
        },
        end: {
          line: 82,
          column: 43
        }
      },
      "15": {
        start: {
          line: 83,
          column: 0
        },
        end: {
          line: 83,
          column: 41
        }
      },
      "16": {
        start: {
          line: 84,
          column: 0
        },
        end: {
          line: 84,
          column: 37
        }
      },
      "17": {
        start: {
          line: 87,
          column: 16
        },
        end: {
          line: 87,
          column: 37
        }
      },
      "18": {
        start: {
          line: 88,
          column: 0
        },
        end: {
          line: 90,
          column: 1
        }
      },
      "19": {
        start: {
          line: 89,
          column: 2
        },
        end: {
          line: 89,
          column: 33
        }
      },
      "20": {
        start: {
          line: 92,
          column: 23
        },
        end: {
          line: 92,
          column: 62
        }
      },
      "21": {
        start: {
          line: 95,
          column: 15
        },
        end: {
          line: 95,
          column: 38
        }
      },
      "22": {
        start: {
          line: 100,
          column: 2
        },
        end: {
          line: 108,
          column: 3
        }
      },
      "23": {
        start: {
          line: 101,
          column: 4
        },
        end: {
          line: 105,
          column: 5
        }
      },
      "24": {
        start: {
          line: 102,
          column: 6
        },
        end: {
          line: 102,
          column: 29
        }
      },
      "25": {
        start: {
          line: 104,
          column: 6
        },
        end: {
          line: 104,
          column: 33
        }
      },
      "26": {
        start: {
          line: 107,
          column: 4
        },
        end: {
          line: 107,
          column: 31
        }
      },
      "27": {
        start: {
          line: 112,
          column: 18
        },
        end: {
          line: 113,
          column: 52
        }
      },
      "28": {
        start: {
          line: 113,
          column: 4
        },
        end: {
          line: 113,
          column: 52
        }
      },
      "29": {
        start: {
          line: 114,
          column: 18
        },
        end: {
          line: 115,
          column: 49
        }
      },
      "30": {
        start: {
          line: 115,
          column: 4
        },
        end: {
          line: 115,
          column: 49
        }
      },
      "31": {
        start: {
          line: 117,
          column: 2
        },
        end: {
          line: 119,
          column: 4
        }
      },
      "32": {
        start: {
          line: 120,
          column: 2
        },
        end: {
          line: 133,
          column: 4
        }
      },
      "33": {
        start: {
          line: 134,
          column: 2
        },
        end: {
          line: 146,
          column: 4
        }
      },
      "34": {
        start: {
          line: 147,
          column: 2
        },
        end: {
          line: 160,
          column: 4
        }
      }
    },
    fnMap: {
      "0": {
        name: "(anonymous_0)",
        decl: {
          start: {
            line: 31,
            column: 22
          },
          end: {
            line: 31,
            column: 23
          }
        },
        loc: {
          start: {
            line: 32,
            column: 2
          },
          end: {
            line: 32,
            column: 41
          }
        },
        line: 32
      },
      "1": {
        name: "detectEditorType",
        decl: {
          start: {
            line: 43,
            column: 9
          },
          end: {
            line: 43,
            column: 25
          }
        },
        loc: {
          start: {
            line: 43,
            column: 48
          },
          end: {
            line: 52,
            column: 1
          }
        },
        line: 43
      },
      "2": {
        name: "detectEditorCmd",
        decl: {
          start: {
            line: 59,
            column: 9
          },
          end: {
            line: 59,
            column: 24
          }
        },
        loc: {
          start: {
            line: 59,
            column: 47
          },
          end: {
            line: 71,
            column: 1
          }
        },
        line: 59
      },
      "3": {
        name: "detectEditorPattern",
        decl: {
          start: {
            line: 77,
            column: 9
          },
          end: {
            line: 77,
            column: 28
          }
        },
        loc: {
          start: {
            line: 77,
            column: 51
          },
          end: {
            line: 79,
            column: 1
          }
        },
        line: 77
      },
      "4": {
        name: "openInEditor",
        decl: {
          start: {
            line: 97,
            column: 30
          },
          end: {
            line: 97,
            column: 42
          }
        },
        loc: {
          start: {
            line: 97,
            column: 74
          },
          end: {
            line: 109,
            column: 1
          }
        },
        line: 97
      },
      "5": {
        name: "printErrorMessage",
        decl: {
          start: {
            line: 111,
            column: 9
          },
          end: {
            line: 111,
            column: 26
          }
        },
        loc: {
          start: {
            line: 111,
            column: 45
          },
          end: {
            line: 161,
            column: 1
          }
        },
        line: 111
      },
      "6": {
        name: "(anonymous_6)",
        decl: {
          start: {
            line: 112,
            column: 18
          },
          end: {
            line: 112,
            column: 19
          }
        },
        loc: {
          start: {
            line: 113,
            column: 4
          },
          end: {
            line: 113,
            column: 52
          }
        },
        line: 113
      },
      "7": {
        name: "(anonymous_7)",
        decl: {
          start: {
            line: 114,
            column: 18
          },
          end: {
            line: 114,
            column: 19
          }
        },
        loc: {
          start: {
            line: 115,
            column: 4
          },
          end: {
            line: 115,
            column: 49
          }
        },
        line: 115
      }
    },
    branchMap: {
      "0": {
        loc: {
          start: {
            line: 44,
            column: 2
          },
          end: {
            line: 49,
            column: 3
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 44,
            column: 2
          },
          end: {
            line: 49,
            column: 3
          }
        }, {
          start: {
            line: 44,
            column: 2
          },
          end: {
            line: 49,
            column: 3
          }
        }],
        line: 44
      },
      "1": {
        loc: {
          start: {
            line: 46,
            column: 4
          },
          end: {
            line: 48,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 46,
            column: 4
          },
          end: {
            line: 48,
            column: 5
          }
        }, {
          start: {
            line: 46,
            column: 4
          },
          end: {
            line: 48,
            column: 5
          }
        }],
        line: 46
      },
      "2": {
        loc: {
          start: {
            line: 61,
            column: 2
          },
          end: {
            line: 63,
            column: 3
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 61,
            column: 2
          },
          end: {
            line: 63,
            column: 3
          }
        }, {
          start: {
            line: 61,
            column: 2
          },
          end: {
            line: 63,
            column: 3
          }
        }],
        line: 61
      },
      "3": {
        loc: {
          start: {
            line: 66,
            column: 2
          },
          end: {
            line: 68,
            column: 3
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 66,
            column: 2
          },
          end: {
            line: 68,
            column: 3
          }
        }, {
          start: {
            line: 66,
            column: 2
          },
          end: {
            line: 68,
            column: 3
          }
        }],
        line: 66
      },
      "4": {
        loc: {
          start: {
            line: 66,
            column: 6
          },
          end: {
            line: 66,
            column: 74
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 66,
            column: 6
          },
          end: {
            line: 66,
            column: 30
          }
        }, {
          start: {
            line: 66,
            column: 34
          },
          end: {
            line: 66,
            column: 74
          }
        }],
        line: 66
      },
      "5": {
        loc: {
          start: {
            line: 78,
            column: 9
          },
          end: {
            line: 78,
            column: 54
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 78,
            column: 9
          },
          end: {
            line: 78,
            column: 41
          }
        }, {
          start: {
            line: 78,
            column: 45
          },
          end: {
            line: 78,
            column: 54
          }
        }],
        line: 78
      },
      "6": {
        loc: {
          start: {
            line: 88,
            column: 0
          },
          end: {
            line: 90,
            column: 1
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 88,
            column: 0
          },
          end: {
            line: 90,
            column: 1
          }
        }, {
          start: {
            line: 88,
            column: 0
          },
          end: {
            line: 90,
            column: 1
          }
        }],
        line: 88
      },
      "7": {
        loc: {
          start: {
            line: 92,
            column: 23
          },
          end: {
            line: 92,
            column: 62
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 92,
            column: 23
          },
          end: {
            line: 92,
            column: 42
          }
        }, {
          start: {
            line: 92,
            column: 46
          },
          end: {
            line: 92,
            column: 62
          }
        }],
        line: 92
      },
      "8": {
        loc: {
          start: {
            line: 100,
            column: 2
          },
          end: {
            line: 108,
            column: 3
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 100,
            column: 2
          },
          end: {
            line: 108,
            column: 3
          }
        }, {
          start: {
            line: 100,
            column: 2
          },
          end: {
            line: 108,
            column: 3
          }
        }],
        line: 100
      },
      "9": {
        loc: {
          start: {
            line: 100,
            column: 6
          },
          end: {
            line: 100,
            column: 30
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 100,
            column: 6
          },
          end: {
            line: 100,
            column: 12
          }
        }, {
          start: {
            line: 100,
            column: 16
          },
          end: {
            line: 100,
            column: 30
          }
        }],
        line: 100
      }
    },
    s: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0,
      "13": 0,
      "14": 0,
      "15": 0,
      "16": 0,
      "17": 0,
      "18": 0,
      "19": 0,
      "20": 0,
      "21": 0,
      "22": 0,
      "23": 0,
      "24": 0,
      "25": 0,
      "26": 0,
      "27": 0,
      "28": 0,
      "29": 0,
      "30": 0,
      "31": 0,
      "32": 0,
      "33": 0,
      "34": 0
    },
    f: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0
    },
    b: {
      "0": [0, 0],
      "1": [0, 0],
      "2": [0, 0],
      "3": [0, 0],
      "4": [0, 0],
      "5": [0, 0],
      "6": [0, 0],
      "7": [0, 0],
      "8": [0, 0],
      "9": [0, 0]
    },
    _coverageSchema: "43e27e138ebf9cfc5966b082cf9a028302ed4184",
    hash: "92e7dced54177813dd240aefab92b05474905ca0"
  };
  var coverage = global[gcv] || (global[gcv] = {});

  if (coverage[path] && coverage[path].hash === hash) {
    return coverage[path];
  }

  return coverage[path] = coverageData;
}();

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = openInEditor;

var _path = _interopRequireDefault(require("path"));

var _openInEditor = require("open-in-editor");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const editors = (cov_1quqfxxwz1.s[0]++, Object.keys(require('open-in-editor/lib/editors')));
/**
 * --- OVERVIEW ---
 *
 * React Native apps show a stack trace when an error occurs. Each
 * frame can be tapped on by the user. When they do, React Native will
 * send a POST to /open-stack-frame passing along {file, lineNumber}.
 *
 * Haul should then open the user's editor to the file and lineNumber.
 *
 * What makes this gloriously fragile is, people use different editors
 * on different platforms.
 *
 * We will rely on the NPM package `open-in-editor` to provide this
 * functionality. (read: scapegoat).
 */
// A configuration object fed into `open-in-editor`.

cov_1quqfxxwz1.s[1]++;

// does `open-in-editor` know how to detect this editor?
const isKnownEditor = editor => {
  cov_1quqfxxwz1.f[0]++;
  cov_1quqfxxwz1.s[2]++;
  return editors.includes(_path.default.basename(editor));
};
/**
 * Detect the editor type to use. We use just the basename in case the user
 * has passed a full path. Just the name work here though. Examples:
 *
 *   - sublime
 *   - atom
 *   - /usr/local/bin/atom
 *
 */


function detectEditorType() {
  cov_1quqfxxwz1.f[1]++;
  cov_1quqfxxwz1.s[3]++;

  if (process.env.REACT_EDITOR) {
    cov_1quqfxxwz1.b[0][0]++;
    const editor = (cov_1quqfxxwz1.s[4]++, _path.default.basename(process.env.REACT_EDITOR));
    cov_1quqfxxwz1.s[5]++;

    if (isKnownEditor(editor)) {
      cov_1quqfxxwz1.b[1][0]++;
      cov_1quqfxxwz1.s[6]++;
      return editor;
    } else {
      cov_1quqfxxwz1.b[1][1]++;
    }
  } else {
    cov_1quqfxxwz1.b[0][1]++;
  }

  cov_1quqfxxwz1.s[7]++;
  return undefined;
}
/**
 * If provided, this will be the editor command that we shell out to. You only
 * need to use this if you've got a specific script or symlink you're trying
 * to target.
 */


function detectEditorCmd() {
  cov_1quqfxxwz1.f[2]++;
  cov_1quqfxxwz1.s[8]++;

  // the specific haul command gets precedent
  if (process.env.REACT_EDITOR_CMD) {
    cov_1quqfxxwz1.b[2][0]++;
    cov_1quqfxxwz1.s[9]++;
    return process.env.REACT_EDITOR_CMD;
  } else {
    cov_1quqfxxwz1.b[2][1]++;
  } // use REACT_EDITOR unless it's a shortcut (like just the word 'atom')


  cov_1quqfxxwz1.s[10]++;

  if ((cov_1quqfxxwz1.b[4][0]++, process.env.REACT_EDITOR) && (cov_1quqfxxwz1.b[4][1]++, !isKnownEditor(process.env.REACT_EDITOR))) {
    cov_1quqfxxwz1.b[3][0]++;
    cov_1quqfxxwz1.s[11]++;
    return process.env.REACT_EDITOR;
  } else {
    cov_1quqfxxwz1.b[3][1]++;
  }

  cov_1quqfxxwz1.s[12]++;
  return undefined;
}
/**
 * If provided, this allows people to control how the arguments are passed
 * to their editor.  For example: -r -g {filename}:{line}:{column}
 */


function detectEditorPattern() {
  cov_1quqfxxwz1.f[3]++;
  cov_1quqfxxwz1.s[13]++;
  return (cov_1quqfxxwz1.b[5][0]++, process.env.REACT_EDITOR_PATTERN) || (cov_1quqfxxwz1.b[5][1]++, undefined);
} // configure the editor open library


const editorConfig = (cov_1quqfxxwz1.s[14]++, {});
cov_1quqfxxwz1.s[15]++;
editorConfig.editor = detectEditorType();
cov_1quqfxxwz1.s[16]++;
editorConfig.cmd = detectEditorCmd(); // null is a valid pattern, so we need to only add it if we mean it

const pattern = (cov_1quqfxxwz1.s[17]++, detectEditorPattern());
cov_1quqfxxwz1.s[18]++;

if (pattern) {
  cov_1quqfxxwz1.b[6][0]++;
  cov_1quqfxxwz1.s[19]++;
  editorConfig.pattern = pattern;
} else {
  cov_1quqfxxwz1.b[6][1]++;
}

const hasValidConfig = (cov_1quqfxxwz1.s[20]++, (cov_1quqfxxwz1.b[7][0]++, editorConfig.editor) || (cov_1quqfxxwz1.b[7][1]++, editorConfig.cmd)); // create an editor we'll use to open editor.

const opener = (cov_1quqfxxwz1.s[21]++, (0, _openInEditor.configure)(editorConfig));

async function openInEditor(runtime, url) {
  cov_1quqfxxwz1.f[4]++;
  cov_1quqfxxwz1.s[22]++;

  // open it with the user's editor. the extra hasValidConfig check effectively
  // turns off `open-in-editor`'s auto detection, which i found didn't work.
  if ((cov_1quqfxxwz1.b[9][0]++, opener) && (cov_1quqfxxwz1.b[9][1]++, hasValidConfig)) {
    cov_1quqfxxwz1.b[8][0]++;
    cov_1quqfxxwz1.s[23]++;

    try {
      cov_1quqfxxwz1.s[24]++;
      await opener.open(url);
    } catch (error) {
      cov_1quqfxxwz1.s[25]++;
      printErrorMessage(runtime); // problem opening?
    }
  } else {
    cov_1quqfxxwz1.b[8][1]++;
    cov_1quqfxxwz1.s[26]++;
    printErrorMessage(runtime);
  }
}

function printErrorMessage(runtime) {
  cov_1quqfxxwz1.f[5]++;
  cov_1quqfxxwz1.s[27]++;

  const boldify = text => {
    cov_1quqfxxwz1.f[6]++;
    cov_1quqfxxwz1.s[28]++;
    return runtime.logger.enhanceWithModifier('bold', text);
  };

  cov_1quqfxxwz1.s[29]++;

  const greyify = text => {
    cov_1quqfxxwz1.f[7]++;
    cov_1quqfxxwz1.s[30]++;
    return runtime.logger.enhanceWithColor('gray', text);
  };

  cov_1quqfxxwz1.s[31]++;
  runtime.logger.error('Unable to open in editor. You can set environment variables to open your editor.');
  cov_1quqfxxwz1.s[32]++;
  runtime.logger.info([' --- Easiest (auto-detect) ---', '', `${boldify('export REACT_EDITOR=code')}`, `${greyify('or')}`, `${boldify('export REACT_EDITOR=/path/to/atom')}`, '', `${greyify('(sublime, atom, code, webstorm, phpstorm, idea14ce, vim, emacs, visualstudio)')}`, `${greyify('via https://github.com/lahmatiy/open-in-editor')}`].join('\n'));
  cov_1quqfxxwz1.s[33]++;
  runtime.logger.info([' --- Harder (you have a custom script or symlink) ---', '', `${boldify('export REACT_EDITOR=vim')}`, `${boldify('export REACT_EDITOR_CMD=/usr/local/bin/nvim')}`, `${boldify('export REACT_EDITOR=/path/to/atom')}`, '', `${greyify('You can use this if you have recognized editor, but in non-standard location.')}`].join('\n'));
  cov_1quqfxxwz1.s[34]++;
  runtime.logger.info([' --- Hardest (completely custom -- hold my beer) ---', '', `${boldify('export REACT_EDITOR_CMD=/path/to/a/crazy/editor')}`, `${boldify('export REACT_EDITOR_PATTERN="-r -g {filename}:{line}:{column}"')}`, '', `${greyify('You can use this if your editor is unknown or you want to launch with different flags.')}`].join('\n'));
}
//# sourceMappingURL=openInEditor.js.map